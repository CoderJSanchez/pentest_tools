#!/bin/bash

# Check if nmap.txt exists
if [ ! -f "nmap.txt" ]; then
    echo "The file nmap.txt does not exist."
    exit 1
fi

# Create ports.txt from nmap.txt
awk '{for(i=1;i<=NF;i++) if($i ~ /^[0-9]+\/tcp/) print substr($i, 1, index($i, "/")-1)}' nmap.txt > ports.txt

# Check if ports.txt was created successfully
if [ ! -f "ports.txt" ]; then
    echo "Failed to create ports.txt."
    exit 1
fi

echo "ports.txt created successfully."

# Sleep for 2 seconds
sleep 2

# Check if create_notes.sh is executable, if not make it executable
if [ ! -x "./create_notes.sh" ]; then
    echo "create_notes.sh is not executable. Attempting to make it executable."
    chmod +x ./create_notes.sh
    
    # Verify if chmod was successful
    if [ ! -x "./create_notes.sh" ]; then
        echo "Failed to make create_notes.sh executable."
        exit 1
    fi
fi

# Run create_notes.sh
./create_notes.sh

# Check if create_notes.sh ran successfully
if [ $? -eq 0 ]; then
    echo "create_notes.sh ran successfully."
else
    echo "create_notes.sh encountered an error."
    exit 1
fi
